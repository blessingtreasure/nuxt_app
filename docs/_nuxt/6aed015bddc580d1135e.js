(window.webpackJsonp=window.webpackJsonp||[]).push([[13],{493:function(e,t,r){var content=r(577);"string"==typeof content&&(content=[[e.i,content,""]]),content.locals&&(e.exports=content.locals);(0,r(12).default)("11637e64",content,!0,{sourceMap:!1})},575:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=Object.assign||function(e){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var t in source)Object.prototype.hasOwnProperty.call(source,t)&&(e[t]=source[t])}return e};t.quillRedefine=function(e){var t=e.placeholder||"please write here ...",r=e.theme||"snow",o=e.toolOptions||[["bold","italic","underline","strike"],["blockquote","code-block"],[{header:1},{header:2}],[{list:"ordered"},{list:"bullet"}],[{script:"sub"},{script:"super"}],[{indent:"-1"},{indent:"+1"}],[{direction:"rtl"}],[{size:["small",!1,"large","huge"]}],[{header:[1,2,3,4,5,6,!1]}],[{color:[]},{background:[]}],[{font:[]}],[{align:[]}],["clean"],["link","image","video"]],l=Object.assign({action:"",methods:"POST",name:"img",accept:"image/png, image/gif, image/jpeg, image/bmp, image/x-icon"},e.uploadConfig),c=e.handlers||{};return{placeholder:t,theme:r,modules:{toolbar:{container:o,handlers:n({},c,{image:function(){var e=this,t=this.container.querySelector("input.ql-image[type=file]");null===t&&((t=document.createElement("input")).setAttribute("type","file"),l.name&&t.setAttribute("name",l.name),t.setAttribute("accept",l.accept),t.classList.add("ql-image"),t.addEventListener("change",(function(){if(l.change&&l.change(r),l.size&&t.files[0].size>=1024*l.size)t.value="";else{var r=new FormData;r.append(l.name,t.files[0]),l.token&&r.append("token",l.token);var n=new XMLHttpRequest;n.open(l.methods,l.action,!0),l.header&&l.header(n,r),n.onload=function(r){if(200===n.status){var o=JSON.parse(n.responseText),c=l.res(o),d=e.quill.getSelection(!0).index;e.quill.insertEmbed(d,"image",c),e.quill.setSelection(d+1),l.success&&l.success()}t.value=""},n.upload.onloadstart=function(e){t.value="",l.start&&l.start()},n.upload.onerror=function(e){l.error&&l.error()},n.upload.onloadend=function(e){l.end&&l.end()},n.send(r)}})),this.container.appendChild(t)),t.click()}})}}}}},576:function(e,t,r){"use strict";var n=r(493);r.n(n).a},577:function(e,t,r){(t=r(11)(!1)).push([e.i,".container[data-v-030d10f9]{width:1000px;overflow:hidden;margin:25px auto 0}.release[data-v-030d10f9]{float:left;width:700px}.release h3[data-v-030d10f9]{font-weight:400;font-size:23px}.release p[data-v-030d10f9]{color:#999;font-size:14px;padding:9px 0}.release .editor[data-v-030d10f9]{height:541px;margin-bottom:0}.release .editor .quill-editor[data-v-030d10f9]{height:400px}.release[data-v-030d10f9] .el-form-item__label{text-align:left}.release .submit[data-v-030d10f9]{font-size:14px;padding:10px 0;margin-bottom:10px}.release .submit .el-button[data-v-030d10f9]{margin-right:10px}.release .submit .release-temp[data-v-030d10f9]{color:orange}.temp[data-v-030d10f9]{width:300px;float:right}.temp .draft[data-v-030d10f9]{height:41px;padding:10px 5px;border:1px solid #ddd}.temp .draft[data-v-030d10f9],.temp .draft-content[data-v-030d10f9]{width:260px;float:right}.temp .draft-content .draft-item[data-v-030d10f9]{cursor:pointer;display:block;border-bottom:1px solid #ccc}.temp .draft-content .draft-item .draft-title[data-v-030d10f9]{padding:20px}.temp .draft-content .draft-item .draft-item-content[data-v-030d10f9]{height:60px;font-size:14px;overflow:hidden;display:-webkit-box;-webkit-box-orient:vertical;-webkit-line-clamp:3}",""]),e.exports=t},596:function(e,t,r){"use strict";r.r(t);r(132),r(26),r(27),r(14),r(93),r(25),r(51);var n=r(5),o=(r(64),r(65)),l=r(575),c=r(127);function d(object,e){var t=Object.keys(object);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(object);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(object,e).enumerable}))),t.push.apply(t,r)}return t}function f(e){for(var i=1;i<arguments.length;i++){var source=null!=arguments[i]?arguments[i]:{};i%2?d(Object(source),!0).forEach((function(t){Object(o.a)(e,t,source[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(source)):d(Object(source)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(source,t))}))}return e}var m={data:function(){return{form:{title:"",content:"",city:"",cityName:""},rules:{title:[{required:!0,message:"请输入标题",trigger:"blur"}],content:[{required:!0,message:"请输入内容"}],cityName:{required:!0,message:"请选择城市"}},uploadUrl:"",editorOption:{},loading:"",index:""}},mounted:function(){var e=this;this.uploadUrl=this.$axios.defaults.baseURL+"/upload",this.editorOption=Object(l.quillRedefine)({uploadConfig:{action:this.uploadUrl,start:function(){e.loading=e.$loading({lock:!0,text:"上传中。。。",spinner:"el-icon-loading",background:"rgba(0,0,0,.7)"})},res:function(t){return e.$axios.defaults.baseURL+t[0].url},success:function(){e.loading.close()},name:"files"}})},computed:f({},Object(c.b)({draftList:function(e){var t=JSON.parse(JSON.stringify(e.post.draftList));return 0!==t.length&&t.map((function(e){return e.content=e.content.replace(/<img.*>/gi,""),e}))},draft:function(e){return!!e.post.draft&&(this.form=f({},e.post.draft),"111111")}})),watch:{},methods:{queryCity:function(e,t){var r=this;return Object(n.a)(regeneratorRuntime.mark((function n(){var o,l,c;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(e){n.next=2;break}return n.abrupt("return",!1);case 2:return n.next=4,r.$axios({url:"/airs/city",params:{name:e}});case 4:o=n.sent,l=o.data,c=l.data.map((function(e){return e.value=e.name,e})),t(c);case 8:case"end":return n.stop()}}),n)})))()},handleDepartSelect:function(e){this.form.city=e.id},releasePost:function(){var e=this;this.$refs.formRef.validate(function(){var t=Object(n.a)(regeneratorRuntime.mark((function t(r){var n,o;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(r){t.next=2;break}return t.abrupt("return",!1);case 2:return e.draft&&e.$store.commit("post/removeDraft",e.index),t.next=5,e.$axios({method:"post",url:"/posts",headers:{Authorization:"Bearer "+e.$store.state.user.userInfo.token},data:e.form});case 5:n=t.sent,"新增成功"===(o=n.data).message&&(e.$message.success(o.message),e.form={title:"",content:"",city:"",cityName:""}),e.$refs.formRef.resetFields();case 9:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}())},saveDraft:function(){var e=this;this.$refs.formRef.validate(function(){var t=Object(n.a)(regeneratorRuntime.mark((function t(r){var n;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(r){t.next=2;break}return t.abrupt("return",!1);case 2:n=f({},e.form),e.$store.commit("post/setDraft",n),e.$message.success("已存为草稿"),e.$refs.formRef.resetFields();case 6:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}())},showDraft:function(e){this.$store.commit("post/getDraftDetail",e),this.index=e},imgHandler:function(e){if(console.log(e),e){var t=document.getElementById("fileInput");console.log(t),t.click()}}}},v=(r(576),r(13)),component=Object(v.a)(m,(function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticClass:"container"},[r("div",{staticClass:"release"},[r("h3",[e._v("发表新攻略")]),e._v(" "),r("p",[e._v("分享你的个游记,让更多人看到哦!")]),e._v(" "),r("el-form",{ref:"formRef",attrs:{model:e.form,rules:e.rules}},[r("el-form-item",{attrs:{prop:"title"}},[r("el-input",{attrs:{placeholder:"请输入标题"},model:{value:e.form.title,callback:function(t){e.$set(e.form,"title",t)},expression:"form.title"}})],1),e._v(" "),r("el-form-item",{staticClass:"editor",attrs:{prop:"content"}},[r("client-only",[r("quill-editor",{ref:"editRef",attrs:{options:e.editorOption},model:{value:e.form.content,callback:function(t){e.$set(e.form,"content",t)},expression:"form.content"}})],1),e._v(" "),r("input",{staticStyle:{display:"none"},attrs:{id:"fileInput",type:"file"}})],1),e._v(" "),r("el-form-item",{staticClass:"city",attrs:{label:"选择城市","label-width":"80px",prop:"cityName"}},[r("el-autocomplete",{staticStyle:{width:"200px"},attrs:{"fetch-suggestions":e.queryCity,placeholder:"请搜索游玩城市"},on:{select:e.handleDepartSelect},model:{value:e.form.cityName,callback:function(t){e.$set(e.form,"cityName",t)},expression:"form.cityName"}})],1)],1),e._v(" "),r("div",{staticClass:"submit"},[r("el-button",{attrs:{type:"primary",size:"mini"},on:{click:e.releasePost}},[e._v("发布")]),e._v("或者\n      "),r("el-button",{staticClass:"release-temp",attrs:{type:"text"},on:{click:e.saveDraft}},[e._v("保存到草稿")])],1)],1),e._v(" "),r("div",{staticClass:"temp"},[r("div",{staticClass:"draft"},[e._v("草稿箱 （"+e._s(e.draftList.length>0?e.draftList.length:0)+"）")]),e._v(" "),r("div",{staticClass:"draft-content"},e._l(e.draftList,(function(t,n){return r("div",{key:n,staticClass:"draft-item",on:{click:function(t){return e.showDraft(n)}}},[r("h4",{staticClass:"draft-title"},[e._v(e._s(t.title))]),e._v(" "),r("div",{staticClass:"draft-item-content",domProps:{innerHTML:e._s(t.content)}})])})),0),e._v(" "),r("div",{directives:[{name:"show",rawName:"v-show",value:!1,expression:"false"}]},[e._v(e._s(e.draft))])])])}),[],!1,null,"030d10f9",null);t.default=component.exports}}]);